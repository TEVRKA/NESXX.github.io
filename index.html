<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏™‰∫∫Èü≥‰πêÁ©∫Èó¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .player {
            background: rgba(50, 50, 50, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .audio-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .controls-row {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        button:hover {
            background: #45a049;
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .play-btn {
            background: #2196F3;
        }

        .play-btn:hover {
            background: #1976D2;
        }

        .progress-container {
            width: 100%;
            background: #333;
            border-radius: 5px;
            height: 10px;
            cursor: pointer;
            margin: 10px 0;
        }

        .progress-bar {
            height: 100%;
            background: #4CAF50;
            border-radius: 5px;
            width: 0%;
            transition: width 0.1s;
        }

        .time-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 14px;
        }

        .visualizer {
            height: 100px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 2px;
            margin: 20px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }

        .bar {
            width: 4px;
            background: #4CAF50;
            border-radius: 2px 2px 0 0;
            transition: height 0.1s;
        }

        .notes-container {
            height: 50px;
            position: relative;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            margin: 10px 0;
        }

        .note {
            position: absolute;
            bottom: 0;
            font-size: 24px;
            animation: float 3s linear infinite;
            opacity: 0.8;
        }

        @keyframes float {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .playlist {
            margin-top: 20px;
        }

        .playlist h3 {
            margin-bottom: 10px;
            color: #4CAF50;
        }

        .song-item {
            padding: 10px;
            border: 1px solid #444;
            border-radius: 5px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .song-item:hover {
            background: rgba(76, 175, 80, 0.2);
        }

        .song-item.active {
            background: rgba(76, 175, 80, 0.4);
            border-color: #4CAF50;
        }

        .current-song {
            text-align: center;
            margin-bottom: 10px;
            font-size: 18px;
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéµ ‰∏™‰∫∫Èü≥‰πêÁ©∫Èó¥ üéµ</h1>
    </div>

    <div class="container">
        <div class="player">
            <div class="current-song" id="currentSong">ËØ∑ÈÄâÊã©‰∏ÄÈ¶ñÊ≠åÊõ≤</div>
            
            <div class="audio-controls">
                <div class="controls-row">
                    <button id="prevBtn" class="play-btn">‚èÆÔ∏è ‰∏ä‰∏ÄÈ¶ñ</button>
                    <button id="playBtn" class="play-btn">‚ñ∂Ô∏è Êí≠Êîæ</button>
                    <button id="nextBtn" class="play-btn">‚è≠Ô∏è ‰∏ã‰∏ÄÈ¶ñ</button>
                </div>
                
                <div class="controls-row">
                    <button id="loopBtn">üîÑ ÂçïÊõ≤Âæ™ÁéØ</button>
                    <button id="shuffleBtn">üîÄ ÈöèÊú∫Êí≠Êîæ</button>
                </div>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div class="time-info">
                <span id="currentTime">00:00</span>
                <span id="totalTime">00:00</span>
            </div>

            <div class="visualizer" id="visualizer"></div>
            
            <div class="notes-container" id="notesContainer"></div>
        </div>

        <div class="playlist">
            <h3>Êí≠ÊîæÂàóË°®</h3>
            <div id="playlist"></div>
        </div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        class MusicPlayer {
            constructor() {
                this.audio = document.getElementById('audioPlayer');
                this.playBtn = document.getElementById('playBtn');
                this.prevBtn = document.getElementById('prevBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.loopBtn = document.getElementById('loopBtn');
                this.shuffleBtn = document.getElementById('shuffleBtn');
                this.progressBar = document.getElementById('progressBar');
                this.progressContainer = document.getElementById('progressContainer');
                this.currentTimeEl = document.getElementById('currentTime');
                this.totalTimeEl = document.getElementById('totalTime');
                this.visualizer = document.getElementById('visualizer');
                this.notesContainer = document.getElementById('notesContainer');
                this.playlistEl = document.getElementById('playlist');
                this.currentSongEl = document.getElementById('currentSong');

                this.songs = [];
                this.currentSongIndex = -1;
                this.isPlaying = false;
                this.isLooping = false;
                this.isShuffled = false;
                this.audioContext = null;
                this.analyser = null;
                this.audioData = null;
                this.animationId = null;

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.createVisualizerBars();
                this.loadSongsFromAudioFolder();
            }

            setupEventListeners() {
                this.playBtn.addEventListener('click', () => this.togglePlay());
                this.prevBtn.addEventListener('click', () => this.playPrev());
                this.nextBtn.addEventListener('click', () => this.playNext());
                this.loopBtn.addEventListener('click', () => this.toggleLoop());
                this.shuffleBtn.addEventListener('click', () => this.toggleShuffle());
                
                this.audio.addEventListener('timeupdate', () => this.updateProgress());
                this.audio.addEventListener('ended', () => this.onSongEnd());
                this.audio.addEventListener('loadedmetadata', () => this.updateTotalTime());
                
                this.progressContainer.addEventListener('click', (e) => this.seek(e));
            }

            createVisualizerBars() {
                this.visualizer.innerHTML = '';
                for (let i = 0; i < 64; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'bar';
                    bar.style.height = '2px';
                    this.visualizer.appendChild(bar);
                }
            }

            loadSongsFromAudioFolder() {
                this.songs = [
                    { name: 'Take Me Hand - DAISHI DANCE„ÄÅC√©cile Corbel.mp3' },
                    { name: 'H√•ll om mig - Nanne.mp3' },
                    { name: 'IVORY TOWER (feat. SennaRin) (feat. SennaRin) - Êæ§ÈáéÂºò‰πã„ÄÅSennaRin.mp3' },
                    { name: 'MY ALL - Êª®Â¥éÊ≠•.mp3' },
                    { name: 'Rage Beneath the Mountains Â≤©Â£ë‰πãÂ¥© - ÈôàËá¥ÈÄ∏„ÄÅHOYO-MiX.mp3' },
                    { name: 'The Mass (Album Version) - Era.mp3' },
                    { name: 'This Is It.mp3' },
                    { name: 'ÂÖ≥Â±±ÈÖí (DJÂêçÈæôÁâà).mp3' },
                    { name: 'Â•áËøπÂÜçÁé∞.mp3' },
                    { name: 'Âº±Ê∞¥‰∏âÂçÉ (Ê¢®Ëä±È£òËêΩÂú®‰Ω†Á™óÂâç).mp3' },
                    { name: 'Êé¢ÊïÖÁü• (Ë∂ÖÊ¢¶ÂπªDJÁâà).mp3' },
                    { name: 'Ê≤àÂõ≠Â§ñ (DJÁâà).mp3' },
                    { name: 'Ê∏∏‰∫¨ (ÁáÉÊÉÖÁâà).mp3' },
                    { name: 'Ë∂ÖÂÖΩÊ≠¶Ë£Ö.mp3' }
                ];
                this.songs.forEach((song, index) => {
                    song.url = `audio/${encodeURIComponent(song.name)}`;
                });
                
                this.renderPlaylist();
            }

            renderPlaylist() {
                this.playlistEl.innerHTML = '';
                this.songs.forEach((song, index) => {
                    const songItem = document.createElement('div');
                    songItem.className = 'song-item';
                    songItem.textContent = song.name;
                    if (index === this.currentSongIndex) {
                        songItem.classList.add('active');
                    }
                    songItem.addEventListener('click', () => this.playSong(index));
                    this.playlistEl.appendChild(songItem);
                });
            }

            playSong(index) {
                if (index < 0 || index >= this.songs.length) return;

                this.currentSongIndex = index;
                const song = this.songs[index];
                
                // ÊûÑÂª∫Èü≥È¢ëÊñá‰ª∂ÁöÑÂÆûÈôÖË∑ØÂæÑ
                this.audio.src = song.url;
                this.currentSongEl.textContent = `Ê≠£Âú®Êí≠Êîæ: ${song.name}`;
                
                this.renderPlaylist();
                this.audio.play().then(() => {
                    this.isPlaying = true;
                    this.playBtn.textContent = '‚è∏Ô∏è ÊöÇÂÅú';
                    this.setupAudioContext();
                    this.startVisualization();
                }).catch(e => {
                    console.error('Êí≠ÊîæÂ§±Ë¥•:', e);
                    alert(`Êó†Ê≥ïÊí≠ÊîæÊ≠åÊõ≤: ${song.name}\nËØ∑Á°Æ‰øùaudioÊñá‰ª∂Â§π‰∏≠Â≠òÂú®ËØ•Êñá‰ª∂`);
                });
            }

            togglePlay() {
                if (this.currentSongIndex === -1 && this.songs.length > 0) {
                    this.playSong(0);
                    return;
                }

                if (this.isPlaying) {
                    this.audio.pause();
                    this.isPlaying = false;
                    this.playBtn.textContent = '‚ñ∂Ô∏è Êí≠Êîæ';
                    this.stopVisualization();
                } else {
                    this.audio.play();
                    this.isPlaying = true;
                    this.playBtn.textContent = '‚è∏Ô∏è ÊöÇÂÅú';
                    this.setupAudioContext();
                    this.startVisualization();
                }
            }

            playPrev() {
                let newIndex = this.currentSongIndex - 1;
                if (newIndex < 0) {
                    newIndex = this.isShuffled ? Math.floor(Math.random() * this.songs.length) : this.songs.length - 1;
                }
                this.playSong(newIndex);
            }

            playNext() {
                let newIndex = this.currentSongIndex + 1;
                if (newIndex >= this.songs.length) {
                    newIndex = this.isShuffled ? Math.floor(Math.random() * this.songs.length) : 0;
                }
                this.playSong(newIndex);
            }

            toggleLoop() {
                this.isLooping = !this.isLooping;
                this.audio.loop = this.isLooping;
                this.loopBtn.textContent = this.isLooping ? 'üîÑ ÂçïÊõ≤Âæ™ÁéØ(ÂºÄ)' : 'üîÑ ÂçïÊõ≤Âæ™ÁéØ(ÂÖ≥)';
            }

            toggleShuffle() {
                this.isShuffled = !this.isShuffled;
                this.shuffleBtn.textContent = this.isShuffled ? 'üîÄ ÈöèÊú∫Êí≠Êîæ(ÂºÄ)' : 'üîÄ ÈöèÊú∫Êí≠Êîæ(ÂÖ≥)';
            }

            updateProgress() {
                const percent = (this.audio.currentTime / this.audio.duration) * 100;
                this.progressBar.style.width = `${percent}%`;
                this.currentTimeEl.textContent = this.formatTime(this.audio.currentTime);
            }

            updateTotalTime() {
                this.totalTimeEl.textContent = this.formatTime(this.audio.duration);
            }

            formatTime(seconds) {
                if (isNaN(seconds)) return '00:00';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

            seek(e) {
                const width = this.progressContainer.clientWidth;
                const clickX = e.offsetX;
                const duration = this.audio.duration;
                this.audio.currentTime = (clickX / width) * duration;
            }

            onSongEnd() {
                if (this.isLooping) {
                    this.audio.currentTime = 0;
                    this.audio.play();
                } else {
                    this.playNext();
                }
            }

            setupAudioContext() {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.analyser = this.audioContext.createAnalyser();
                    const source = this.audioContext.createMediaElementSource(this.audio);
                    source.connect(this.analyser);
                    this.analyser.connect(this.audioContext.destination);
                    this.analyser.fftSize = 128;
                    this.audioData = new Uint8Array(this.analyser.frequencyBinCount);
                }
            }

            startVisualization() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
                this.animateVisualizer();
            }

            stopVisualization() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                }
                // ÈáçÁΩÆÈü≥Êü±
                const bars = this.visualizer.querySelectorAll('.bar');
                bars.forEach(bar => {
                    bar.style.height = '2px';
                });
            }

            animateVisualizer() {
                if (!this.analyser || !this.audioData) return;

                this.analyser.getByteFrequencyData(this.audioData);
                
                const bars = this.visualizer.querySelectorAll('.bar');
                for (let i = 0; i < bars.length && i < this.audioData.length; i++) {
                    const value = this.audioData[i];
                    const height = (value / 255) * 80 + 2; // ÊúÄÂ∞èÈ´òÂ∫¶2px
                    bars[i].style.height = `${height}px`;
                }

                // ÈöèÊú∫ÁîüÊàêÈü≥Á¨¶
                if (Math.random() < 0.3) {
                    this.createNote();
                }

                this.animationId = requestAnimationFrame(() => this.animateVisualizer());
            }

            createNote() {
                const notes = ['‚ô™', '‚ô´', '‚ô≠', '‚ô™', '‚ô´'];
                const note = document.createElement('div');
                note.className = 'note';
                note.textContent = notes[Math.floor(Math.random() * notes.length)];
                note.style.left = `${Math.random() * 100}%`;
                note.style.color = `hsl(${Math.random() * 360}, 100%, 70%)`;
                note.style.fontSize = `${Math.random() * 20 + 16}px`;
